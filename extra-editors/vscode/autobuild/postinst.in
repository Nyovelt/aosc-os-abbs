ARCH=@ARCH@

TEMP_PATH="$(mktemp -d)"

cd "$TEMP_PATH"

echo -e "Downloading Visual Studio Code ..."
wget https://packages.microsoft.com/repos/code/pool/main/c/code/code_@PKGVER@-@TIMESTAMP@_@ARCH@.deb

echo -e "Extracting Visual Studio Code ..."
dpkg -x code_@PKGVER@-@TIMESTAMP@_@ARCH@.deb \
    $TEMP_PATH/vscode

echo -e "Installing Visual Studio Code ..."

sed -e 's|/usr/share/code/code|/usr/lib/vscode/code|g' \
    -i "$TEMP_PATH"/vscode/usr/share/applications/code.desktop \
    -i "$TEMP_PATH"/vscode/usr/share/applications/code-url-handler.desktop

mkdir -p /usr/{bin,lib}
cp -a "$TEMP_PATH"/vscode/usr/share/code \
    /usr/lib/vscode

for i in applications bash-completion mime pixmaps zsh; do
    mkdir -p /usr/share/$i
    cp -a "$TEMP_PATH"/vscode/usr/share/$i/* \
        /usr/share/$i/
done

ln -sf ../lib/vscode/code \
    /usr/bin/vscode

