#!/bin/sh -e

if [[ ! -f "$HOME/.vscode/.user_allow" ]]; then
    export TEXTDOMAIN=vscode_launcher
    . gettext.sh
    read -r -d '|' MESSAGE <<EOF
Microsoft's official Visual Studio Code release may collect your usage data on an opt-out basis, per the <a href="https://code.visualstudio.com/license">Microsoft Software License Terms</a>.
This default setting does not comply with our guidelines on telemetry in our packaged software, per section 5 of the <a href="https://wiki.aosc.io/developer/packaging/package-styling-manual/#package-features">AOSC OS Packaging Styling Manual</a>.
We offer an Telemetry-free alternative, VSCodium (package: vscodium).

Would you like to proceed with launching Visual Studio Code?

By selecting "Yes," you agree to the License Terms referenced above and consent launching an application which violates our software packaging guidelines.|
EOF
    MESSAGE_TEXT="$(eval_gettext "$MESSAGE")"
    zenity --question --window-icon="/usr/share/icons/gnome/48x48/status/dialog-warning.png" --icon-name="dialog-warning" --no-wrap --title "Warning" --text "$MESSAGE_TEXT"
    mkdir -p "$HOME/.vscode"
    touch "$HOME/.vscode/.user_allow"
fi

/usr/lib/vscode/code "$@"
